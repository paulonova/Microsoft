COMSCORE.SiteRecruit.Utils.getPageSize=function(t){switch(t){case 0:return"0%";case 1:return"50%";case 2:return"100%";default:return"0%"}},COMSCORE.SiteRecruit.Utils.openWindow=function(t,e){if(COMSCORE.SiteRecruit.Builder.invitation&&COMSCORE.SiteRecruit.Builder.invitation.config&&COMSCORE.SiteRecruit.Broker.config.isWindowOpener)return COMSCORE.SiteRecruit.Broker.config.isWindowOpener=!1,e=e||"",window.open(t,"",e)},COMSCORE.SiteRecruit.Utils.toQueryString=function(t){var e,i,n,o=[];for(e=t.length-1;0<=e;e--){var r=t[e];o.push((i=r.n,n=r.v,escape(i)+"="+(null===n?"":escape(n))))}return o.join("&")},COMSCORE.SiteRecruit.Utils.lang={extend:function(t,e,i){if(e&&t){var n=function(){};if(n.prototype=e.prototype,t.prototype=new n,(t.prototype.constructor=t).superclass=e.prototype,e.prototype.constructor==Object.prototype.constructor&&(e.prototype.constructor=e),i)for(var o in i)t.prototype[o]=i[o]}}},COMSCORE.SiteRecruit.Invitation={METHODOLOGY:{STANDARD:0,EMAIL:1,DD:2,QINVITE:3,CDDS:4,CLE:5,MDDS:6},REMOVE_DELAY:{ACCEPT:500,DECLINE:200},acceptHandlerTag:"@acceptHandler",declineHandlerTag:"@declineHandler",acceptHandler:"return COMSCORE.SiteRecruit.Builder.invitation.accept(this)",declineHandler:"return COMSCORE.SiteRecruit.Builder.invitation.decline(this); return false"},COMSCORE.SiteRecruit.Invitation.Renderer=function(){var e=0,i=0,n=0,o=0,r=COMSCORE.SiteRecruit.Utils;return{HORIZONTAL_ALIGNMENT:{LEFT:0,MIDDLE:1,RIGHT:2},VERTICAL_ALIGNMENT:{TOP:0,MIDDLE:1,BOTTOM:2},init:function(){var t=this.invitation.config;switch(n=t.width/2,o=t.height/2,t.horizontalAlignment){case this.HORIZONTAL_ALIGNMENT.LEFT:e=t.horizontalMargin;break;case this.HORIZONTAL_ALIGNMENT.MIDDLE:e=r.getPageSize(1);break;case this.HORIZONTAL_ALIGNMENT.RIGHT:e=r.getPageSize(2)}switch(t.verticalAlignment){case this.VERTICAL_ALIGNMENT.TOP:i=t.verticalMargin;break;case this.VERTICAL_ALIGNMENT.MIDDLE:i=r.getPageSize(1);break;case this.VERTICAL_ALIGNMENT.BOTTOM:o=t.height,i=r.getPageSize(2)}this.setPosition(e,i,n,o)},start:function(t){this.invitation=t,this.init(),document.getElementById("grayMask")&&(document.getElementById("grayMask").style.visibility="visible"),t.container.style.visibility="visible",t.logView()},setPosition:function(t,e,i,n){var o=this.invitation.container.style;o.left=t,o.top=e,o.marginLeft=-1*i+"px",o.marginTop=-1*n+"px"},destroy:function(){this.invitation.config.Events.beforeDestroy();var t=this.invitation.container;function r(t){var e,i,n,o=t.attributes;if(o)for(i=o.length,e=0;e<i;e+=1)null!==o[e]&&(n=o[e].name),"function"==typeof t[n]&&(t[n]=null);if(o=t.childNodes)for(i=o.length,e=0;e<i;e+=1)r(t.childNodes[e])}t.style.visibility="hidden",this.invitation.config.grayMask&&(this.invitation.config.gm.style.visibility="hidden",r(this.invitation.config.grayMask)),r(t);try{t.parentNode.removeChild(t)}catch(t){}}}}(),COMSCORE.SiteRecruit.Invitation.BaseInvitation=function(t){this.config=t},COMSCORE.SiteRecruit.Invitation.BaseInvitation.prototype={constructor:COMSCORE.SiteRecruit.Invitation.BaseInvitation,logView:function(){var t=COMSCORE.SiteRecruit,e=t.Utils,i=t.Builder.invitation.config,n=t.Broker.config.cookie,o={};o.cookiename=n.name,o.cookieoptions=n;var r=e.UserPersistence.getUserObj(o),c=this.config.viewParams||"";c+="&c1=12",c+="&c2="+i.projectId,c+="&c3="+i.acceptParams.siteCode,c+="&c4=1",c+="&c5="+t.device.type,c+="&c6="+i.methodology,c+="&c7="+escape(e.referrer),c+="&c8="+escape(e.location),c+="&c9="+r.userid,"https:"!=location.protocol&&this.config.viewUrl||(this.config.viewUrl="https://sb.scorecardresearch.com/b2");var a=e.appendQueryParams(this.config.viewUrl,c);/nobcn/i.test(e.UserPersistence.getCookieValue("tstMode"))||e.fireBeacon(a)},updateContentPaths:function(){var t=COMSCORE.SiteRecruit.executingPath;this.content=this.content.replace(/url\((.+?)\)/gim,"url("+t+"$1)"),this.content=this.content.replace(/src=['"](.+?)['"]/gim,"src='"+t+"$1'")},preRender:function(){var t=COMSCORE.SiteRecruit.Invitation,e=new RegExp(t.acceptHandlerTag,"g"),i=new RegExp(t.declineHandlerTag,"g");this.config.Events.beforeRender(),this.config.closeWithEsc&&!0===this.config.closeWithEsc&&(document.onkeyup=function(t){27==(t=t||window.event).keyCode&&COMSCORE.SiteRecruit.Builder.invitation.decline(this)}),this.content=this.config.content.replace(e,t.acceptHandler),this.content=this.content.replace(i,t.declineHandler),this.updateContentPaths()},inject:function(){COMSCORE.SiteRecruit.Invitation.Renderer.start(this)},addOutlnEvent:function(e){e.addEventListener?e.addEventListener("focus",function(t){e.style.outline="1px dashed black"},!1):e.attachEvent&&e.attachEvent("focus",function(t){e.style.outline="1px dashed black"})},removeOutlnEvent:function(e){e.addEventListener?e.addEventListener("blur",function(t){e.style.outline=0},!1):e.attachEvent&&e.attachEvent("blur",function(t){e.style.outline=0})},loadAccessibility:function(t,e){try{var i=t.lastElementChild,n=i.getElementsByTagName("a")[3],o=document.getElementById("csInvContent");setTimeout(function(){i.setAttribute("role","document"),i.setAttribute("tabindex","0"),e.addOutlnEvent(i),e.removeOutlnEvent(i),n.addEventListener("keydown",function(t){if(9==t.keyCode&&!t.shiftKey)return"visible"==document.getElementById("csInv").style.visibility&&"csPriv"==document.activeElement.id&&document.getElementById("csInv").focus(),!1},!1),i.addEventListener("keydown",function(t){if(t.shiftKey&&9==t.keyCode)return"visible"==document.getElementById("csInv").style.visibility&&"csInv"==document.activeElement.id&&document.getElementById("csPriv").focus(),!1},!1),o.addEventListener("keydown",function(t){if(t.shiftKey&&9==t.keyCode)return"visible"==document.getElementById("csInv").style.visibility&&"csInvContent"==document.activeElement.id&&document.getElementById("csPriv").focus(),!1},!1),document.getElementById("csInv").focus()},this.config.revealDelay+1e3)}catch(t){}},render:function(){this.preRender(),this.container=document.createElement("div");var t=this.container;"string"==typeof this.content?t.innerHTML=this.content:t.appendChild(this.content);var e=t.style;t.id="csInv",t.setAttribute("role","dialog"),t.setAttribute("aria-label","Microsoft Survey: Give us your opinion"),t.setAttribute("tabindex","0"),!0===this.config.isAutoCentering?e.position="fixed":e.position="absolute",e.left="0px",e.top="0px",e.marginLeft="0px",e.marginTop="0px",e.zIndex=1999999999999,e.visibility="hidden",document.body.appendChild(t),this.config.revealDelay=this.config.revealDelay||1;var i=this;if(setTimeout(function(){i.inject()},this.config.revealDelay),this.config.grayMask){var n=this.config.gm;(n=document.createElement("div")).id="grayMask",n.style.visibility="hidden",n.style.position="fixed",n.style.top="0px",n.style.left="0px",n.style.padding="0px",n.style.width="100%",n.style.height="100%",n.style.backgroundColor="#333333",n.style.zIndex=1e4,n.style.opacity=.7,n.style.filter="alpha(opacity=70)",document.body.appendChild(n)}1==COMSCORE.SiteRecruit.device.type&&this.loadAccessibility(t,i),this.config.Events.afterRender()},removeInvitation:function(t){t=t||1,setTimeout(function(){COMSCORE.SiteRecruit.Invitation.Renderer.destroy()},t)},decline:function(){return this.config.Events.beforeDecline(),this.removeInvitation(COMSCORE.SiteRecruit.Invitation.REMOVE_DELAY.DECLINE),!1},accept:function(){var t=COMSCORE.SiteRecruit,e=t.Utils,i=t.Builder.invitation.config,n=t.Broker.config.cookie,o={};o.cookiename=n.name,o.cookieoptions=n;var r=e.UserPersistence.getUserObj(o);this.config.Events.beforeAccept(),this.removeInvitation(t.Invitation.REMOVE_DELAY.ACCEPT),this.surveyData=t.Builder.collectSurveyData();var c=t.Builder.invitation.config,a="c1=12";a+="&c2="+c.projectId,a+="&c3="+c.acceptParams.siteCode,a+="&c4=2",a+="&c5="+t.device.type,a+="&c6="+i.methodology,a+="&c7="+escape(e.referrer),a+="&c8="+escape(e.location),a+="&c9="+r.userid,"https:"==location.protocol&&(this.config.viewUrl="https://sb.scorecardresearch.com/b2");var s=e.appendQueryParams(this.config.viewUrl,a);/nobcn/i.test(e.UserPersistence.getCookieValue("tstMode"))||e.fireBeacon(s)},appendSurveyDataToAcceptUrl:function(t){var e=COMSCORE.SiteRecruit.Utils,i=e.toQueryString(this.surveyData)+"&"+this.config.acceptParams.raw;COMSCORE.SiteRecruit.Broker.scriptArgs&&(i+="&"+COMSCORE.SiteRecruit.Broker.scriptArgs);var n={};n.cookiename=COMSCORE.SiteRecruit.Broker.config.cookie.name,n.cookieoptions=COMSCORE.SiteRecruit.Broker.config.cookie;var o=e.UserPersistence.getUserObj(n);o&&o.userid&&o.userid&&(i+="&userid="+o.userid);var r=COMSCORE.SiteRecruit;return r.device&&r.device.type&&(i+="&device="+r.device.type),r.Builder.invitation&&r.Builder.invitation.config&&("0"==r.Builder.invitation.config.methodology||r.Builder.invitation.config.methodology)&&(i+="&SRmethodology="+r.Builder.invitation.config.methodology),(/cs\_tstMode/i.test(window.location)||/tstMode/.test(document.cookie))&&(i+="&cs_tstMode=1"),e.appendQueryParams(t,i)}},COMSCORE.SiteRecruit.Invitation.Standard=function(t){COMSCORE.SiteRecruit.Invitation.Standard.superclass.constructor.call(this,t)},COMSCORE.SiteRecruit.Utils.lang.extend(COMSCORE.SiteRecruit.Invitation.Standard,COMSCORE.SiteRecruit.Invitation.BaseInvitation,{accept:function(){COMSCORE.SiteRecruit.Invitation.Standard.superclass.accept.call(this);var t={};t.cookiename=COMSCORE.SiteRecruit.Broker.config.cookie.name,t.cookieoptions=COMSCORE.SiteRecruit.Broker.config.cookie,t.statename=COMSCORE.SiteRecruit.CONSTANTS.STATE_NAME.IDLE,t.pid=this.config.projectId,COMSCORE.SiteRecruit.Utils.UserPersistence.setUserObj(t);var e=this.appendSurveyDataToAcceptUrl(this.config.acceptUrl);5==COMSCORE.SiteRecruit.Builder.invitation.config.methodology?window.location.href=e:COMSCORE.SiteRecruit.Utils.openWindow(e,"width=400,height=400,resizable=1,scrollbars=1,status=1")},toString:function(){return"Standard"}}),COMSCORE.SiteRecruit.Invitation.DD=function(t){COMSCORE.SiteRecruit.Invitation.DD.superclass.constructor.call(this,t)},COMSCORE.SiteRecruit.Invitation.DD.ORIENTATION={DEFAULT:0,CENTER:1,BOTTOMCENTER:2,BOTTOMLEFT:3,BOTTOMRIGHT:4},COMSCORE.SiteRecruit.Utils.lang.extend(COMSCORE.SiteRecruit.Invitation.DD,COMSCORE.SiteRecruit.Invitation.BaseInvitation,{accept:function(){var t=COMSCORE.SiteRecruit,e=t.Broker,i=e.config;t.Invitation.DD.superclass.accept.call(this);var n=t.Builder.addSurveyParam,o=i.cookie;n("surveyUrl",this.config.acceptUrl),n("cookieName",o.name),n("cookiePath",o.path),n("cookieDomain",o.domain),n("cookieDuration",o.duration),n("cookieDate",o.date),n("trackerPageConfigUrl",t.executingPath+this.config.trackerWindow.trackerPageConfigUrl),t.DDKeepAlive.setDDTrackerCookie();var r={};r.cookiename=o.name,r.trackertimestamp=(new Date).getTime(),r.cookieoptions=o,t.Utils.UserPersistence.setUserObj(r);var c,a="";if(a=e&&i&&i.tracker&&i.tracker.ssl&&""!==i.tracker.ssl?i.tracker.ssl:t.executingPath+this.config.url,c=this.appendSurveyDataToAcceptUrl(a),6!=COMSCORE.SiteRecruit.Builder.invitation.config.methodology)e.processDDInProgress(),this.openWindow(c);else{COMSCORE.SiteRecruit.Utils.UserPersistence.setIdleAlreadyAskedCookie(90);var s=COMSCORE.SiteRecruit.Builder.invitation.config,u="mDDS=1,pid="+s.projectId+",site="+s.acceptParams.siteCode+",frequency="+COMSCORE.SiteRecruit.Broker.pagemap.f+"; path=/; domain=.microsoft.com";document.cookie=u,COMSCORE.SiteRecruit.Utils.loadScript(COMSCORE.SiteRecruit.executingPath+"inv_mdds_"+s.projectId+"_"+s.acceptParams.siteCode+".js",!0),COMSCORE.SiteRecruit.Broker.track={},"undefined"==typeof Storage?COMSCORE.SiteRecruit.Broker.track={support:!1}:(COMSCORE.SiteRecruit.Broker.track={support:!0,locationList:escape(COMSCORE.SiteRecruit.Utils.cleanURL(window.location.toString())),timeList:(new Date).getTime()},sessionStorage.locationList=COMSCORE.SiteRecruit.Broker.track.locationList,sessionStorage.timeList=COMSCORE.SiteRecruit.Broker.track.timeList,sessionStorage.csLocation=escape(COMSCORE.SiteRecruit.Utils.cleanURL(window.location.toString())),sessionStorage.csReferrer=escape(COMSCORE.SiteRecruit.Utils.cleanURL(document.referrer)))}},openWindow:function(t){var e=this.config.trackerWindow,i=e.features||"resizable=1,status=1,scrollbars=1";if(e){if(e.width?i+=",width="+e.width:i+=",width=400",e.height?i+=",height="+e.height:i+=",height=270",e.orientation&&e.width&&e.height){var n,o,r=self.screen.availWidth,c=self.screen.availHeight,a=e.offsetX||0,s=e.offsetY||0,u=COMSCORE.SiteRecruit.Invitation.DD.ORIENTATION;switch(e.orientation){case u.CENTER:n=r/2-e.width/2,o=c/2-e.height/2;break;case u.BOTTOMCENTER:n=r/2-e.width/2,o=c-e.height;break;case u.BOTTOMLEFT:n=0,o=c-e.height;break;case u.BOTTOMRIGHT:n=r-e.width,o=c-e.height}0<e.orientation&&(i+=",left="+(n+=a)+",top="+(o+=s))}COMSCORE.SiteRecruit.Utils.openWindow(t,i)}},toString:function(){return"DD"}}),COMSCORE.SiteRecruit.Invitation.QInvite=function(t){COMSCORE.SiteRecruit.Invitation.QInvite.superclass.constructor.call(this,t)},COMSCORE.SiteRecruit.Invitation.QInvite.tags={random:"@random",item:"@item",end:"@end"},COMSCORE.SiteRecruit.Utils.lang.extend(COMSCORE.SiteRecruit.Invitation.QInvite,COMSCORE.SiteRecruit.Invitation.BaseInvitation,{preRender:function(){COMSCORE.SiteRecruit.Invitation.QInvite.superclass.preRender.call(this)},accept:function(){COMSCORE.SiteRecruit.Invitation.QInvite.superclass.accept.call(this);var t,e={};e.cookiename=COMSCORE.SiteRecruit.Broker.config.cookie.name,e.cookieoptions=COMSCORE.SiteRecruit.Broker.config.cookie,e.statename=COMSCORE.SiteRecruit.CONSTANTS.STATE_NAME.IDLE,e.pid=this.config.projectId,COMSCORE.SiteRecruit.Utils.UserPersistence.setUserObj(e),t=this.appendSurveyDataToAcceptUrl(this.config.acceptUrl),COMSCORE.SiteRecruit.Utils.openWindow(t,"width=400,height=400,resizable=yes,scrollbars=yes")},randomizeQuestions:function(){for(var t,e=this.content.match(/@random.*?@endrandom/gm),i=0;null!==(t=e.pop());){var n="CS__ITEMLIST_"+i++;this.content=this.content.replace(/@random.*?@endrandom/,n);var o=t.replace(/@random(.*?)@endrandom/m,"$1"),r=o.match(/@item.*?@enditem/gm);for(r.sort(function(){return Math.random()-.5});r.length;)o=o.replace(/(@item.*?@enditem)/m,r.pop().replace(/@item(.*?)@enditem/m,"$1"));this.content=this.content.replace(new RegExp(n),o)}return this.content},toString:function(){return"QInvite"}}),COMSCORE.SiteRecruit.Builder=function(){var n=COMSCORE.SiteRecruit,u=n.Utils,l=n.Broker;return{sv:"scor",init:function(){if(n.sv===this.sv){var t=n.executingPath+l.pagemap.c;u.loadScript(t,!0)}},start:function(){this.init()},run:function(){if(this.sv===this.config.sv)if(this.chooseInvitation()){if(!this.writeAlreadyAsked())return;this.invitation.render()}else{var t={timestamp:-1};t.cookiename=l.config.cookie.name,t.options=l.config.cookie,u.UserPersistence.setUserObj(t)}},addSurveyParam:function(t,e){var i=n.Builder.invitation.config.acceptParams;i.raw||(i.raw=""),e=e||"",i.raw+="&"+t+"="+escape(e)},createInvitationClass:function(t){var e=l.config.prefixUrl;switch(e&&e,t.methodology){case n.Invitation.METHODOLOGY.STANDARD:return new n.Invitation.Standard(t);case n.Invitation.METHODOLOGY.EMAIL:return new n.Invitation.Email(t);case n.Invitation.METHODOLOGY.DD:return new n.Invitation.DD(t);case n.Invitation.METHODOLOGY.QINVITE:return new n.Invitation.QInvite(t);case n.Invitation.METHODOLOGY.CDDS:return new n.Invitation.DD(t);case n.Invitation.METHODOLOGY.CLE:return new n.Invitation.Standard(t);case n.Invitation.METHODOLOGY.MDDS:return new n.Invitation.DD(t)}return null},chooseInvitation:function(){var t,e,i=this.config.invitation,n=u.UserPersistence.getCookieValue("tstMode");if("string"==typeof n&&-1!=n.indexOf(",")&&(n=n.substring(0,n.indexOf(","))),i)if(1<i.length&&/p\d+/i.test(n)){for(t=i.length-1;0<=t;t--)if((e=i[t]).projectId==n)return this.invitation=this.createInvitationClass(i[t]),!0}else{var o=0;for(t=i.length-1;0<=t;t--)1<=(e=i[t]).weight&&(o+=e.weight);if(1<=o){var r=u.getRandom(o),c=0;for(t=i.length-1;0<=t;t--)if(r<=(c+=i[t].weight))return this.invitation=this.createInvitationClass(i[t]),!0}}return!1},writeAlreadyAsked:function(){if(n.testMode&&l.isDDInProgress())return!0;var t={};t.cookiename=l.config.cookie.name,t.cookieoptions=l.config.cookie,u.UserPersistence.setUserObj(t);var e=u.UserPersistence.getUserObj(t);return e&&e.state.name==n.CONSTANTS.STATE_NAME.IDLE},collectSurveyData:function(){var t,e,i,n,o,r=[{n:"sv",v:l.config.sv},{n:"frequency",v:l.pagemap.f},{n:"weight",v:this.invitation.config.weight},{n:"location",v:escape(u.location)},{n:"referrer",v:escape(COMSCORE.SiteRecruit.Utils.referrer)},{n:"projectId",v:this.invitation.config.projectId},{n:"site",v:this.invitation.config.acceptParams.siteCode}],c=this.invitation.config.acceptParams;if(c){var a="";if(c.cookie){for(t=c.cookie.length-1;0<=t;t--)e=c.cookie[t],a=a.concat(e,":",getCookieValue(e));r.push({n:"otherCookies",v:a})}if(c.form){var s="";for(t=c.form.length-1;0<=t;t--)e=c.form[t],s=s.concat(e,":",(i=c.form[t].form,n=e,void 0,(o=document.forms[i])&&o.elements[n]?o.elements[n].value:""));r.push({n:"otherVariables",v:s})}}return r}}}(),COMSCORE.SiteRecruit.Builder.start();